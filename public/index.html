<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD App with Node.js and SQL Server</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <button class="Todo"><a href="todo.html">Todo</a></button>
        <h2 class="text-center">Employee Management</h2>

        <!-- Form to Add/Update Employee -->
        <form id="event-form">
            <input type="hidden" id="event-id">
            
            <!-- Event Name -->
            <div class="mb-3">
                <label for="eventName">Event Name</label>
                <input type="text" id="eventName" class="form-control" required>
            </div>
            
            <!-- Event Description -->
            <div class="mb-3">
                <label for="eventDescription">Event Description</label>
                <textarea id="eventDescription" class="form-control" required></textarea>
            </div>
            
            <!-- Event Date -->
            <div class="mb-3">
                <label for="eventDate">Event Date</label>
                <input type="datetime-local" id="eventDate" class="form-control" required>
            </div>
            
            <!-- Event Location -->
            <div class="mb-3">
                <label for="eventLocation">Event Location</label>
                <input type="text" id="eventLocation" class="form-control" required>
            </div>
            
            <!-- Event Organizer -->
            <div class="mb-3">
                <label for="eventOrganizer">Event Organizer</label>
                <input type="text" id="eventOrganizer" class="form-control" required>
            </div>
            
            <!-- Max Seats -->
            <div class="mb-3">
                <label for="maxSeats">Max Seats</label>
                <input type="number" id="maxSeats" class="form-control" required>
            </div>
            
            <!-- Save and Reset Buttons -->
            <button type="submit" class="btn btn-success">Save</button>
            <button type="submit" class="btn btn-success" id="update-btn" style="display: none;">Update</button>
            <button type="reset" class="btn btn-primary">Reset</button>
        </form>
        
        <hr>

        <!-- Table to Display Employees -->
        
    </div>
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Event Name</th>
                <th>Event Description</th>
                <th>Event Date</th>
                <th>Event Location</th>
                <th>Event Organizer</th>
                <th>Max Seats</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="events-table">
            <!-- Data will be inserted here dynamically -->
        </tbody>
    </table>
    
    <!-- Modal for Editing Employee -->
    




    
    <!-- Modal for Editing Employee -->
   <!-- Modal for Editing Event -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Event</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="modal-employee-id">
                
                <!-- Event Name -->
                <div class="mb-3">
                    <label class="form-label">Event Name</label>
                    <input type="text" class="form-control" id="modal-name" required>
                </div>
                
                <!-- Event Description -->
                <div class="mb-3">
                    <label class="form-label">Event Description</label>
                    <textarea class="form-control" id="modal-description" required></textarea>
                </div>
                
                <!-- Event Location -->
                <div class="mb-3">
                    <label class="form-label">Event Location</label>
                    <input type="text" class="form-control" id="modal-location" required>
                </div>
                
                <!-- Event Date -->
                <div class="mb-3">
                    <label class="form-label">Event Date</label>
                    <input type="datetime-local" class="form-control" id="modal-date" required>
                </div>
                
                <!-- Event Organizer -->
                <div class="mb-3">
                    <label class="form-label">Event Organizer</label>
                    <input type="text" class="form-control" id="modal-organizer" required>
                </div>
                
                <!-- Max Seats -->
                <div class="mb-3">
                    <label class="form-label">Max Seats</label>
                    <input type="number" class="form-control" id="modal-maxSeats" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-changes">Save Changes</button>
            </div>
        </div>
    </div>
</div>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD App with Node.js and SQL Server</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <button class="Todo"><a href="todo.html">Todo</a></button>
        <h2 class="text-center">Employee Management</h2>

        <!-- Form to Add/Update Employee -->
        <form id="event-form">
            <input type="hidden" id="event-id">
            
            <!-- Event Name -->
            <div class="mb-3">
                <label for="eventName">Event Name</label>
                <input type="text" id="eventName" class="form-control" required>
            </div>
            
            <!-- Event Description -->
            <div class="mb-3">
                <label for="eventDescription">Event Description</label>
                <textarea id="eventDescription" class="form-control" required></textarea>
            </div>
            
            <!-- Event Date -->
            <div class="mb-3">
                <label for="eventDate">Event Date</label>
                <input type="datetime-local" id="eventDate" class="form-control" required>
            </div>
            
            <!-- Event Location -->
            <div class="mb-3">
                <label for="eventLocation">Event Location</label>
                <input type="text" id="eventLocation" class="form-control" required>
            </div>
            
            <!-- Event Organizer -->
            <div class="mb-3">
                <label for="eventOrganizer">Event Organizer</label>
                <input type="text" id="eventOrganizer" class="form-control" required>
            </div>
            
            <!-- Max Seats -->
            <div class="mb-3">
                <label for="maxSeats">Max Seats</label>
                <input type="number" id="maxSeats" class="form-control" required>
            </div>
            
            <!-- Save and Reset Buttons -->
            <button type="submit" class="btn btn-success" id="save-btn">Save</button>
            <button type="submit" class="btn btn-success" id="update-btn" style="display: none;">Update</button>
            <button type="reset" class="btn btn-primary">Reset</button>
        </form>
        
        <hr>

        <!-- Table to Display Employees -->
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Event Name</th>
                    <th>Event Description</th>
                    <th>Event Date</th>
                    <th>Event Location</th>
                    <th>Event Organizer</th>
                    <th>Max Seats</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="events-table">
                <!-- Data will be inserted here dynamically -->
            </tbody>
        </table>
    </div>

    <!-- Modal for Editing Event -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="modal-employee-id">
                    
                    <!-- Event Name -->
                    <div class="mb-3">
                        <label class="form-label">Event Name</label>
                        <input type="text" class="form-control" id="modal-name" required>
                    </div>
                    
                    <!-- Event Description -->
                    <div class="mb-3">
                        <label class="form-label">Event Description</label>
                        <textarea class="form-control" id="modal-description" required></textarea>
                    </div>
                    
                    <!-- Event Location -->
                    <div class="mb-3">
                        <label class="form-label">Event Location</label>
                        <input type="text" class="form-control" id="modal-location" required>
                    </div>
                    
                    <!-- Event Date -->
                    <div class="mb-3">
                        <label class="form-label">Event Date</label>
                        <input type="datetime-local" class="form-control" id="modal-date" required>
                    </div>
                    
                    <!-- Event Organizer -->
                    <div class="mb-3">
                        <label class="form-label">Event Organizer</label>
                        <input type="text" class="form-control" id="modal-organizer" required>
                    </div>
                    
                    <!-- Max Seats -->
                    <div class="mb-3">
                        <label class="form-label">Max Seats</label>
                        <input type="number" class="form-control" id="modal-maxSeats" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-changes">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            loadEvents();

            // Toggle Save/Update buttons based on whether an ID exists
            function toggleButtons() {
                const eventId = $("#event-id").val();
                if (eventId) {
                    $("#update-btn").show();
                    $("#save-btn").hide();
                } else {
                    $("#update-btn").hide();
                    $("#save-btn").show();
                }
            }

            // Load all events from the server
            function loadEvents() {
                $.ajax({
                    url: "http://localhost:3000/events",
                    method: "GET",
                    success: function (response) {
                        let rows = "";
                        response.forEach(event => {
                            rows += `<tr>
                                <td>${event.EventID}</td>
                                <td>${event.EventName}</td>
                                <td>${event.EventDescription}</td>
                                <td>${event.EventDate}</td>
                                <td>${event.EventLocation}</td>
                                <td>${event.EventOrganizer}</td>
                                <td>${event.MaxSeats}</td>
                                <td>
                                    <button class="btn btn-primary btn-sm edit-btn"  
                                        data-id="${event.EventID}" 
                                        data-name="${event.EventName}" 
                                        data-description="${event.EventDescription}" 
                                        data-location="${event.EventLocation}"
                                        data-date="${event.EventDate}"
                                        data-organizer="${event.EventOrganizer}"
                                        data-max="${event.MaxSeats}">
                                        Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm delete" data-id="${event.EventID}">
                                        Delete
                                    </button>
                                </td>
                            </tr>`;
                        });
                        $("#events-table").html(rows);
                    },
                    error: function (err) {
                        alert("Error loading events: " + err.responseText);
                    }
                });
            }

            // Handle Edit Button Click
            $(document).on("click", ".edit-btn", function () {
                let id = $(this).data("id");
                let name = $(this).data("name");
                let description = $(this).data("description");
                let location = $(this).data("location");
                let date = $(this).data("date");
                let organizer = $(this).data("organizer");
                let max = $(this).data("max");

                // Format the date to fit the datetime-local input
                let formattedDate = new Date(date).toISOString().slice(0, 16); // yyyy-MM-ddThh:mm
                $("#eventDate").val(formattedDate);

                $("#event-id").val(id);
                $("#eventName").val(name);
                $("#eventDescription").val(description);
                $("#eventLocation").val(location);
                $("#eventOrganizer").val(organizer);
                $("#maxSeats").val(max);

                toggleButtons(); // Show "Update" button, hide "Save"
            });

            // Handle Save Button Click (to create new event)
            $("#save-btn").click(function (e) {
                e.preventDefault();
                let eventName = $("#eventName").val();
                let eventDescription = $("#eventDescription").val();
                let eventLocation = $("#eventLocation").val();
                let eventDate = $("#eventDate").val();
                let eventOrganizer = $("#eventOrganizer").val();
                let maxSeats = $("#maxSeats").val();

                $.ajax({
                    url: "http://localhost:3000/events",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        eventName: eventName,
                        eventDescription: eventDescription,
                        eventLocation: eventLocation,
                        eventDate: eventDate,
                        eventOrganizer: eventOrganizer,
                        maxSeats: maxSeats
                    }),
                    success: function (response) {
                        Swal.fire('Added!', 'Event has been added.', 'success');
                        loadEvents();
                        $("#event-form")[0].reset(); // Reset form
                        toggleButtons(); // Show "Save" button again
                    },
                    error: function (err) {
                        alert("Error saving event: " + err.responseText);
                    }
                });
            });

            // Handle Update Button Click (to update existing event)
            $("#update-btn").click(function () {
                let id = $("#event-id").val();
                updateEvent(id);
            });

            // Update Event function
            function updateEvent(id) {
                let eventName = $("#eventName").val();
                let eventDescription = $("#eventDescription").val();
                let eventLocation = $("#eventLocation").val();
                let eventDate = $("#eventDate").val();
                let eventOrganizer = $("#eventOrganizer").val();
                let maxSeats = $("#maxSeats").val();

                $.ajax({
                    url: `http://localhost:3000/events/${id}`,
                    method: "PUT",
                    contentType: "application/json",
                    data: JSON.stringify({
                        eventName: eventName,
                        eventDescription: eventDescription,
                        eventLocation: eventLocation,
                        eventDate: eventDate,
                        eventOrganizer: eventOrganizer,
                        maxSeats: maxSeats
                    }),
                    success: function () {
                        Swal.fire('Updated!', 'Event has been updated.', 'success');
                        loadEvents();
                        $("#event-form")[0].reset();
                        toggleButtons(); // Show "Save" button again
                    },
                    error: function (err) {
                        alert("Error updating event: " + err.responseText);
                    }
                });
            }

            // Reset the form and buttons when the modal is closed
            $('#addProductModal').on('hidden.bs.modal', function () {
                $("#event-form")[0].reset();
                toggleButtons(); // Show "Save" button again
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>    
</html>
